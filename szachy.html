<!DOCTYPE html>
<html>
<head>
	<title>Szachy</title>
	<style>
		.board {
			display: flex;
			flex-wrap: wrap;
			width: 400px;
			margin: 0 auto;
			border: 2px solid black;
		}
		
		.square {
			width: 50px;
			height: 50px;
			text-align: center;
			line-height: 50px;
			font-size: 40px;
			cursor: pointer;
		}
		
		.square.white {
			background-color: #f0d9b5;
		}
		
		.square.black {
			background-color: #b58863;
			color: #fff;
		}
		
		.piece {
			font-family: 'Arial Unicode MS', 'Lucida Sans Unicode';
		}
	</style>
</head>
<body>
	<h1>Szachy</h1>
	<p>Kliknij, aby zacząć ruch</p>
	<div class="board"></div>
	
	<script>
		let board = document.querySelector('.board');
		let squares = [];
		let currentPlayer = '';
		let isGameOver = false;
		
		function createBoard() {
			let letters = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
			let numbers = ['1', '2', '3', '4', '5', '6', '7', '8'];
			let isWhite = Math.random() < 0.5; // losowe przypisanie koloru dla gracza
			currentPlayer = isWhite ? 'white' : 'black';
			
			for (let i = 0; i < 8; i++) {
				for (let j = 0; j < 8; j++) {
					let square = document.createElement('div');
					let row = letters[i];
					let column = numbers[j];
					
					square.id = row + column;
					square.className = 'square ' + (i + j) % 2 == 0 ? 'white' : 'black';
					
					if (i == 1 || i == 6) {
						let piece = document.createElement('span');
						piece.className = 'piece';
						piece.innerHTML = '&#' + (isWhite ? 9817 : 9823) + ';';
						square.appendChild(piece);
					} else if ((i == 0 && isWhite) || (i == 7 && !isWhite)) {
						let piece = document.createElement('span');
						piece.className = 'piece';
						
						switch (j) {
							case 0:
							case 7:
								piece.innerHTML = '&#' + (isWhite ? 9814 : 9820) + ';';
								break;
							case 1:
							case 6:
								piece.innerHTML = '&#' + (isWhite ? 9816 : 9822) + ';';
								break;
							case 2:
							case 5:
								piece.innerHTML = '&#' + (isWhite ? 9815 : 9821) + ';';
								break;
							case 3:
								piece.innerHTML = '&#' + (isWhite ? 9813 : 9819) + ';';
														break;
						case 4:
							piece.innerHTML = '&#' + (isWhite ? 9812 : 9818) + ';';
							break;
					}
					
					square.appendChild(piece);
				}
				
				squares.push(square);
				board.appendChild(square);
			}
		}
	}
	
	function handleMove(square) {
		if (isGameOver) {
			return;
		}
		
		let targetSquare = square.target;
		let isValidMove = false;
		
		if (currentPlayer == 'white' && targetSquare.classList.contains('white')) {
			isValidMove = true;
		} else if (currentPlayer == 'black' && targetSquare.classList.contains('black')) {
			isValidMove = true;
		}
		
		if (isValidMove) {
			let currentPiece = targetSquare.querySelector('.piece');
			let currentSquare = targetSquare.id;
			
			if (currentPiece && currentPiece.innerHTML == '&#9817;' && currentPlayer == 'white' && currentSquare[1] == '5') {
				let nextSquare = document.querySelector('#' + currentSquare[0] + '6');
				
				if (!nextSquare.querySelector('.piece')) {
					movePiece(currentPiece, targetSquare, nextSquare);
					checkForCheckmate();
					switchPlayer();
					return;
				}
			} else if (currentPiece && currentPiece.innerHTML == '&#9823;' && currentPlayer == 'black' && currentSquare[1] == '4') {
				let nextSquare = document.querySelector('#' + currentSquare[0] + '3');
				
				if (!nextSquare.querySelector('.piece')) {
					movePiece(currentPiece, targetSquare, nextSquare);
					checkForCheckmate();
					switchPlayer();
					return;
				}
			}
			
			if (currentPiece && currentPiece.classList.contains('selected')) {
				currentPiece.classList.remove('selected');
			} else if (currentPiece) {
				currentPiece.classList.add('selected');
			}
		} else if (square.target.classList.contains('selected')) {
			let selectedPiece = targetSquare.querySelector('.selected');
			
			if (selectedPiece) {
				let isValidMove = false;
				
				if (currentPlayer == 'white' && targetSquare.classList.contains('black')) {
					isValidMove = validateMove(selectedPiece, targetSquare, 'white');
				} else if (currentPlayer == 'black' && targetSquare.classList.contains('white')) {
					isValidMove = validateMove(selectedPiece, targetSquare, 'black');
				}
				
				if (isValidMove) {
					movePiece(selectedPiece, squares.find(x => x.id == selectedPiece.parentNode.id), targetSquare);
					checkForCheckmate();
					switchPlayer();
				}
			}
		}
	}
	
	function movePiece(piece, currentSquare, targetSquare) {
		targetSquare.appendChild(piece);
		currentSquare.innerHTML = '';
	}
	
	function validateMove(piece, targetSquare, player) {
		let currentSquare = squares.find(x => x.id == piece.parentNode.id);
		let isCapture = targetSquare.querySelector('.piece');
		let isValidMove = false;
		
		if (!isCapture) {
			let isStraight = false;
			let isDiagonal = false;
			
			if (currentSquare.id[0] == targetSquare.id[0]) {
				isStraight = true;
			} else if (currentSquare.id[1] == targetSquare.id[1]) {
				isStraight = true;
			} else if (Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0)) == Math.abs(currentSquare.id[1] - targetSquare.id[1])) {
isDiagonal = true;
}
			if (piece.innerHTML == '&#9817;' && player == 'white') {
				if (isStraight && !isCapture && currentSquare.id[1] > targetSquare.id[1] && currentSquare.id[1] - targetSquare.id[1] <= 2 && !targetSquare.querySelector('.piece')) {
					isValidMove = true;
				} else if (isDiagonal && isCapture && currentSquare.id[1] - targetSquare.id[1] == 1 && Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0)) == 1 && targetSquare.querySelector('.piece').classList.contains('black')) {
					isValidMove = true;
				}
			} else if (piece.innerHTML == '&#9823;' && player == 'black') {
				if (isStraight && !isCapture && currentSquare.id[1] < targetSquare.id[1] && targetSquare.id[1] - currentSquare.id[1] <= 2 && !targetSquare.querySelector('.piece')) {
					isValidMove = true;
				} else if (isDiagonal && isCapture && targetSquare.id[1] - currentSquare.id[1] == 1 && Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0)) == 1 && targetSquare.querySelector('.piece').classList.contains('white')) {
					isValidMove = true;
				}
			} else if (piece.innerHTML == '&#9816;' || piece.innerHTML == '&#9822;') {
				let fileDiff = Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0));
				let rankDiff = Math.abs(currentSquare.id[1] - targetSquare.id[1]);
				
				if (isStraight && !isCapture) {
					if (piece.innerHTML == '&#9816;' && player == 'white' && rankDiff <= 7 && !isPieceBlocking(currentSquare, targetSquare, 'vertical')) {
						isValidMove = true;
					} else if (piece.innerHTML == '&#9822;' && player == 'black' && rankDiff <= 7 && !isPieceBlocking(currentSquare, targetSquare, 'vertical')) {
						isValidMove = true;
					}
				} else if (isDiagonal && isCapture && fileDiff == rankDiff) {
					if (piece.innerHTML == '&#9816;' && player == 'white' && rankDiff <= 7 && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('black') && !isPieceBlocking(currentSquare, targetSquare, 'diagonal')) {
						isValidMove = true;
					} else if (piece.innerHTML == '&#9822;' && player == 'black' && rankDiff <= 7 && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('white') && !isPieceBlocking(currentSquare, targetSquare, 'diagonal')) {
						isValidMove = true;
					}
				}
			} else if (piece.innerHTML == '&#9815;' || piece.innerHTML == '&#9821;') {
				let fileDiff = Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0));
				let rankDiff = Math.abs(currentSquare.id[1] - targetSquare.id[1]);
				
				if (isStraight && !isPieceBlocking(currentSquare, targetSquare, 'vertical')) {
if (piece.innerHTML == '♗' || piece.innerHTML == '♝') {
let fileDiff = Math.abs(currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0));
let rankDiff = Math.abs(currentSquare.id[1] - targetSquare.id[1]);
					if (isStraight && !isPieceBlocking(currentSquare, targetSquare, 'vertical')) {
					if (piece.innerHTML == '&#9815;' && player == 'white' && rankDiff <= 7) {
						if (!isCapture && !targetSquare.querySelector('.piece')) {
							isValidMove = true;
						} else if (isCapture && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('black')) {
							isValidMove = true;
						}
					} else if (piece.innerHTML == '&#9821;' && player == 'black' && rankDiff <= 7) {
						if (!isCapture && !targetSquare.querySelector('.piece')) {
							isValidMove = true;
						} else if (isCapture && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('white')) {
							isValidMove = true;
						}
					}
				} else if (isDiagonal && !isPieceBlocking(currentSquare, targetSquare, 'diagonal')) {
					if (piece.innerHTML == '&#9815;' && player == 'white' && fileDiff == rankDiff) {
						if (!isCapture && !targetSquare.querySelector('.piece')) {
							isValidMove = true;
						} else if (isCapture && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('black')) {
							isValidMove = true;
						}
					} else if (piece.innerHTML == '&#9821;' && player == 'black' && fileDiff == rankDiff) {
						if (!isCapture && !targetSquare.querySelector('.piece')) {
							isValidMove = true;
						} else if (isCapture && targetSquare.querySelector('.piece') && targetSquare.querySelector('.piece').classList.contains('white')) {
							isValidMove = true;
						}
					}
				}
			}
			
			if (isValidMove) {
				movePiece(currentSquare, targetSquare);
				isPlayerTurn = false;
				if (player == 'white') {
					player = 'black';
					botMove();
				} else {
					player = 'white';
				}
			} else {
				alert('Invalid move');
			}
		}
	}
}

function movePiece(currentSquare, targetSquare) {
	let pieceToMove = currentSquare.querySelector('.piece');
	targetSquare.appendChild(pieceToMove);
}

function isPieceBlocking(currentSquare, targetSquare, direction) {
	let fileDiff = currentSquare.id[0].charCodeAt(0) - targetSquare.id[0].charCodeAt(0);
	let rankDiff = currentSquare.id[1] - targetSquare.id[1];
	let currentFile = currentSquare.id[0].charCodeAt(0);
	let currentRank = parseInt(currentSquare.id[1]);

	if (direction == 'vertical') {
		if (fileDiff == 0 && rankDiff != 0) {
			let step = rankDiff / Math.abs(rankDiff);
			for (let i = currentRank + step; i != parseInt(targetSquare.id[1]) ; i += step) {
				let square = document.getElementById(currentSquare.id[0] + i);
				if (square.querySelector('.piece')) {
					return true;
				}
			}
		}
	else if (direction == 'diagonal') {
if (Math.abs(fileDiff) == Math.abs(rankDiff)) {
let fileStep = fileDiff / Math.abs(fileDiff);
let rankStep = rankDiff / Math.abs(rankDiff);
let currentFile = currentSquare.id[0].charCodeAt(0);
let currentRank = parseInt(currentSquare.id[1]);
for (let i = 1; i < Math.abs(fileDiff); i++) {
let square = document.getElementById(String.fromCharCode(currentFile + i * fileStep) + (currentRank + i * rankStep));
if (square.querySelector('.piece')) {
return true;
}
}
}
}
return false;
}
	function botMove() {
	let allPieces = document.querySelectorAll('.piece.black');
	let possibleMoves = [];
	for (let i = 0; i < allPieces.length; i++) {
		let piece = allPieces[i];
		let currentSquare = piece.parentNode;
		let file = currentSquare.id[0];
		let rank = currentSquare.id[1];
		for (let j = 0; j < 8; j++) {
			let targetFile = String.fromCharCode(file.charCodeAt(0) + j);
			let targetRank = parseInt(rank) + 1;
			if (targetRank > 8 || targetRank < 1 || targetFile < 'a' || targetFile > 'h') {
				continue;
			}
			let targetSquare = document.getElementById(targetFile + targetRank);
			if (!targetSquare.querySelector('.piece')) {
				possibleMoves.push([currentSquare, targetSquare]);
			} else if (targetSquare.querySelector('.piece').classList.contains('white')) {
				possibleMoves.push([currentSquare, targetSquare]);
			}
		}
	}
	if (possibleMoves.length > 0) {
		let randomIndex = Math.floor(Math.random() * possibleMoves.length);
		let move = possibleMoves[randomIndex];
		movePiece(move[0], move[1]);
		player = 'white';
		isPlayerTurn = true;
	} else {
		alert('Black can\'t move');
	}
}

// Start the game with a random player
let players = ['white', 'black'];
let randomPlayerIndex = Math.floor(Math.random() * players.length);
let player = players[randomPlayerIndex];
if (player == 'black') {
	botMove();
}
let isPlayerTurn = true;
let isPieceSelected = false;
let selectedPiece = null;

initBoard();
</script>
</body>
</html>

